<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>How to Use Forecasters in Merlion — Merlion 1.1.3 documentation</title>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../_static/doctools.js"></script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../../_static/js/theme.js"></script>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="2_ForecastMultivariate.html" rel="next" title="Multivariate Time Series Forecasting"/>
<link href="0_ForecastIntro.html" rel="prev" title="A Gentle Introduction to Forecasting in Merlion"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../../index.html"> Merlion
          </a>
<div class="version">
                v1.1.3
              </div>
<div role="search">
<form action="../../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div><div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../merlion.html">merlion: Time Series Intelligence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ts_datasets.html">ts_datasets: Easy Data Loading</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials &amp; Example Code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#anomaly-detection">Anomaly Detection</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#forecasting">Forecasting</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0_ForecastIntro.html">A Gentle Introduction to Forecasting in Merlion</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to Use Forecasters in Merlion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Model-Initialization">Model Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model-Training">Model Training</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model-Inference">Model Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Model-Visualization-and-Quantitative-Evaluation">Model Visualization and Quantitative Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Saving-&amp;-Loading-Models">Saving &amp; Loading Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Simulating-Live-Model-Deployment">Simulating Live Model Deployment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="2_ForecastMultivariate.html">Multivariate Time Series Forecasting</a></li>
<li class="toctree-l3"><a class="reference internal" href="3_ForecastNewModel.html">Adding a New Forecasting Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#advanced-features">Advanced Features</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift"><nav aria-label="Mobile navigation menu" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../../index.html">Merlion</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="Page navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a class="icon icon-home" href="../../index.html"></a> »</li>
<li><a href="../../tutorials.html">Tutorials &amp; Example Code</a> »</li>
<li>How to Use Forecasters in Merlion</li>
<li class="wy-breadcrumbs-aside">
<a href="../../_sources/examples/forecast/1_ForecastFeatures.ipynb.txt" rel="nofollow"> View page source</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="How-to-Use-Forecasters-in-Merlion">
<h1>How to Use Forecasters in Merlion<a class="headerlink" href="#How-to-Use-Forecasters-in-Merlion" title="Permalink to this heading"></a></h1>
<p>This notebook will guide you through using all the key features of forecasters in Merlion. Specifically, we will explain</p>
<ol class="arabic simple">
<li><p>Initializing a forecasting model (including ensembles and automatic model selectors)</p></li>
<li><p>Training the model</p></li>
<li><p>Producing a forecast with the model</p></li>
<li><p>Visualizing the model’s predictions</p></li>
<li><p>Quantitatively evaluating the model</p></li>
<li><p>Saving and loading a trained model</p></li>
<li><p>Simulating the live deployment of a model using a <code class="docutils literal notranslate"><span class="pre">ForecastEvaluator</span></code></p></li>
</ol>
<p>We will be using a single example time series for this whole notebook. We load it now:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">merlion.utils.time_series</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">ts_datasets.forecast</span> <span class="kn">import</span> <span class="n">M4</span>

<span class="c1"># Load the time series</span>
<span class="c1"># time_series is a time-indexed pandas.DataFrame</span>
<span class="c1"># trainval is a time-indexed pandas.Series indicating whether each timestamp is for training or testing</span>
<span class="n">time_series</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">M4</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">"Hourly"</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">trainval</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">"trainval"</span><span class="p">]</span>

<span class="c1"># Is there any missing data?</span>
<span class="n">timedeltas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time_series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Has missing data: </span><span class="si">{</span><span class="nb">any</span><span class="p">(</span><span class="n">timedeltas</span> <span class="o">!=</span> <span class="n">timedeltas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Visualize the time series and draw a dotted line to indicate the train/test split</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">time_series</span><span class="p">[</span><span class="n">trainval</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="s2">"2"</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">"k"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Split the time series into train/test splits, and convert it to Merlion format</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_pd</span><span class="p">(</span><span class="n">time_series</span><span class="p">[</span><span class="n">trainval</span><span class="p">])</span>
<span class="n">test_data</span>  <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_pd</span><span class="p">(</span><span class="n">time_series</span><span class="p">[</span><span class="o">~</span><span class="n">trainval</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> points in train split, "</span>
      <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> points in test split."</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 414/414 [00:00&lt;00:00, 852.29it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Has missing data: False
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_1_2.png" src="../../_images/examples_forecast_1_ForecastFeatures_1_2.png"/>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
700 points in train split, 48 points in test split.
</pre></div></div>
</div>
<section id="Model-Initialization">
<h2>Model Initialization<a class="headerlink" href="#Model-Initialization" title="Permalink to this heading"></a></h2>
<p>In this notebook, we will use three different forecasting models: 1. ARIMA (a classic stochastic process model) 2. Prophet (Facebook’s popular time series forecasting model) 3. MSES (the Multi-Scale Exponential Smoothing model, developed in-house)</p>
<p>Let’s start by initializing each of them.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import models &amp; configs</span>
<span class="kn">from</span> <span class="nn">merlion.models.forecast.arima</span> <span class="kn">import</span> <span class="n">Arima</span><span class="p">,</span> <span class="n">ArimaConfig</span>
<span class="kn">from</span> <span class="nn">merlion.models.forecast.prophet</span> <span class="kn">import</span> <span class="n">Prophet</span><span class="p">,</span> <span class="n">ProphetConfig</span>
<span class="kn">from</span> <span class="nn">merlion.models.forecast.smoother</span> <span class="kn">import</span> <span class="n">MSES</span><span class="p">,</span> <span class="n">MSESConfig</span>

<span class="c1"># Import data pre-processing transforms</span>
<span class="kn">from</span> <span class="nn">merlion.transform.base</span> <span class="kn">import</span> <span class="n">Identity</span>
<span class="kn">from</span> <span class="nn">merlion.transform.resample</span> <span class="kn">import</span> <span class="n">TemporalResample</span>

<span class="c1"># All models are initialized using the syntax ModelClass(config),</span>
<span class="c1"># where config is a model-specific configuration object. This is where</span>
<span class="c1"># you specify any algorithm-specific hyperparameters, as well as any</span>
<span class="c1"># data pre-processing transforms.</span>

<span class="c1"># ARIMA assumes that input data is sampled at a regular interval,</span>
<span class="c1"># so we set its transform to resample at that interval. We must also specify</span>
<span class="c1"># a maximum prediction horizon.</span>
<span class="n">config1</span> <span class="o">=</span> <span class="n">ArimaConfig</span><span class="p">(</span><span class="n">max_forecast_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                      <span class="n">transform</span><span class="o">=</span><span class="n">TemporalResample</span><span class="p">(</span><span class="n">granularity</span><span class="o">=</span><span class="s2">"1h"</span><span class="p">))</span>
<span class="n">model1</span>  <span class="o">=</span> <span class="n">Arima</span><span class="p">(</span><span class="n">config1</span><span class="p">)</span>


<span class="c1"># Prophet has no real assumptions on the input data (and doesn't require</span>
<span class="c1"># a maximum prediction horizon), so we skip data pre-processing by using</span>
<span class="c1"># the Identity transform.</span>
<span class="n">config2</span> <span class="o">=</span> <span class="n">ProphetConfig</span><span class="p">(</span><span class="n">max_forecast_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">Identity</span><span class="p">())</span>
<span class="n">model2</span>  <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span><span class="n">config2</span><span class="p">)</span>


<span class="c1"># MSES assumes that the input data is sampled at a regular interval,</span>
<span class="c1"># and requires us to specify a maximum prediction horizon. We will</span>
<span class="c1"># also specify its look-back hyperparameter to be 60 here</span>
<span class="n">config3</span> <span class="o">=</span> <span class="n">MSESConfig</span><span class="p">(</span><span class="n">max_forecast_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_backstep</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="n">TemporalResample</span><span class="p">(</span><span class="n">granularity</span><span class="o">=</span><span class="s2">"1h"</span><span class="p">))</span>
<span class="n">model3</span>  <span class="o">=</span> <span class="n">MSES</span><span class="p">(</span><span class="n">config3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now that we have initialized the individual models, we will also combine them in two different ensembles: <code class="docutils literal notranslate"><span class="pre">ensemble</span></code> simply takes the mean prediction of each individual model, and <code class="docutils literal notranslate"><span class="pre">selector</span></code> selects the best individual model based on its sMAPE (symmetric Mean Average Precision Error). The sMAPE is a metric used to evaluate the quality of a continuous forecast. For ground truth <span class="math notranslate nohighlight">\(y \in \mathbb{R}^T\)</span> and prediction <span class="math notranslate nohighlight">\(\hat{y} \in \mathbb{R}^T\)</span>, the sMAPE is computed as</p>
<div class="math notranslate nohighlight">
\[\mathrm{sMAPE}(y, \hat{y}) = \frac{200}{T} \sum_{t = 1}^{T} \frac{\lvert \hat{y}_t - y_t \rvert}{\lvert\hat{y}_t\rvert + \lvert y_t \rvert}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">merlion.evaluate.forecast</span> <span class="kn">import</span> <span class="n">ForecastMetric</span>
<span class="kn">from</span> <span class="nn">merlion.models.ensemble.combine</span> <span class="kn">import</span> <span class="n">Mean</span><span class="p">,</span> <span class="n">ModelSelector</span>
<span class="kn">from</span> <span class="nn">merlion.models.ensemble.forecast</span> <span class="kn">import</span> <span class="n">ForecasterEnsemble</span><span class="p">,</span> <span class="n">ForecasterEnsembleConfig</span>

<span class="c1"># The ForecasterEnsemble is a forecaster, and we treat it as a first-class model.</span>
<span class="c1"># Its config takes a combiner object, specifying how you want to combine the</span>
<span class="c1"># predictions of individual models in the ensemble. There are two ways to specify</span>
<span class="c1"># the actual models in the ensemble, which we cover below.</span>

<span class="c1"># The first way to specify the models in the ensemble is to provide them when</span>
<span class="c1"># initializing the ForecasterEnsembleConfig.</span>
<span class="c1">#</span>
<span class="c1"># The combiner here will simply take the mean prediction of the ensembles here</span>
<span class="n">ensemble_config</span> <span class="o">=</span> <span class="n">ForecasterEnsembleConfig</span><span class="p">(</span>
    <span class="n">combiner</span><span class="o">=</span><span class="n">Mean</span><span class="p">(),</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">model3</span><span class="p">])</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">ForecasterEnsemble</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ensemble_config</span><span class="p">)</span>


<span class="c1"># Alternatively, you can directly specify the models when initializing the</span>
<span class="c1"># ForecasterEnsemble itself.</span>
<span class="c1">#</span>
<span class="c1"># The combiner here uses the sMAPE to compare individual models, and</span>
<span class="c1"># selects the model with the lowest sMAPE</span>
<span class="n">selector_config</span> <span class="o">=</span> <span class="n">ForecasterEnsembleConfig</span><span class="p">(</span>
    <span class="n">combiner</span><span class="o">=</span><span class="n">ModelSelector</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="p">))</span>
<span class="n">selector</span> <span class="o">=</span> <span class="n">ForecasterEnsemble</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">selector_config</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">model3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="Model-Training">
<h2>Model Training<a class="headerlink" href="#Model-Training" title="Permalink to this heading"></a></h2>
<p>All forecasting models (and ensembles) share the same API for training. The <code class="docutils literal notranslate"><span class="pre">train()</span></code> method returns the model’s predictions and standard error of those predictions on the training data. Note that the standard error is just <code class="docutils literal notranslate"><span class="pre">None</span></code> if the model doesn’t support uncertainty estimation (this is the case for MSES and ensembles).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Training </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span class="n">forecast1</span><span class="p">,</span> <span class="n">stderr1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span class="n">forecast2</span><span class="p">,</span> <span class="n">stderr2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span class="n">forecast3</span><span class="p">,</span> <span class="n">stderr3</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training ensemble..."</span><span class="p">)</span>
<span class="n">forecast_e</span><span class="p">,</span> <span class="n">stderr_e</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training model selector..."</span><span class="p">)</span>
<span class="n">forecast_s</span><span class="p">,</span> <span class="n">stderr_s</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Done!"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training Arima...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Training Prophet...

Training MSES...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Training ensemble...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Training model selector...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
INFO:merlion.models.ensemble.forecast:Evaluating validation performance...
INFO:merlion.models.ensemble.forecast:Re-training model 1/3 (Arima) on full data...
INFO:merlion.models.ensemble.forecast:Re-training model 2/3 (Prophet) on full data...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Re-training model 3/3 (MSES) on full data...
INFO:merlion.models.ensemble.forecast:Models used (of 3): 1 (Arima)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Done!
</pre></div></div>
</div>
</section>
<section id="Model-Inference">
<h2>Model Inference<a class="headerlink" href="#Model-Inference" title="Permalink to this heading"></a></h2>
<p>To obtain a forecast from a trained model, we simply call <code class="docutils literal notranslate"><span class="pre">model.forecast()</span></code> with the Unix timestamps at which we the model to generate a forecast. In many cases, you may obtain these directly from a time series as shown below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Truncate the test data to ensure that we are within each model's maximum</span>
<span class="c1"># forecast horizon.</span>
<span class="n">sub_test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>

<span class="c1"># Obtain the time stamps corresponding to the test data</span>
<span class="n">time_stamps</span> <span class="o">=</span> <span class="n">sub_test_data</span><span class="o">.</span><span class="n">univariates</span><span class="p">[</span><span class="n">sub_test_data</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">time_stamps</span>

<span class="c1"># Get the forecast &amp; standard error of each model. These are both</span>
<span class="c1"># merlion.utils.TimeSeries objects. Note that the standard error is None for</span>
<span class="c1"># models which don't support uncertainty estimation (like MSES and all</span>
<span class="c1"># ensembles).</span>
<span class="n">forecast1</span><span class="p">,</span> <span class="n">stderr1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">)</span>
<span class="n">forecast2</span><span class="p">,</span> <span class="n">stderr2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">)</span>

<span class="c1"># You may optionally specify a time series prefix as context. If one isn't</span>
<span class="c1"># specified, the prefix is assumed to be the training data. Here, we just make</span>
<span class="c1"># this dependence explicit. More generally, this feature is useful if you want</span>
<span class="c1"># to use a pre-trained model to make predictions on data further in the future</span>
<span class="c1"># from the last time it was trained.</span>
<span class="n">forecast3</span><span class="p">,</span> <span class="n">stderr3</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">,</span> <span class="n">time_series_prev</span><span class="o">=</span><span class="n">train_data</span><span class="p">)</span>

<span class="c1"># The same options are available for ensembles as well, though the stderr is None</span>
<span class="n">forecast_e</span><span class="p">,</span> <span class="n">stderr_e</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">)</span>
<span class="n">forecast_s</span><span class="p">,</span> <span class="n">stderr_s</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">time_stamps</span><span class="o">=</span><span class="n">time_stamps</span><span class="p">,</span> <span class="n">time_series_prev</span><span class="o">=</span><span class="n">train_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Model-Visualization-and-Quantitative-Evaluation">
<h2>Model Visualization and Quantitative Evaluation<a class="headerlink" href="#Model-Visualization-and-Quantitative-Evaluation" title="Permalink to this heading"></a></h2>
<p>It is fairly transparent to visualize a model’s forecast and also quantitatively evaluate the forecast, using standard metrics like sMAPE. We show examples for all five models below.</p>
<p>Below, we quantitatively evaluate the models using the sMAPE metric. However, the <code class="docutils literal notranslate"><span class="pre">ForecastMetric</span></code> enum includes a number of other options as well. In general, you may use the syntax</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ForecastMetric.&lt;metric_name&gt;.value(ground_truth=ground_truth, predict=forecast)
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;metric_name&gt;</span></code> is the name of the evaluation metric (see the API docs for details and more options), <code class="docutils literal notranslate"><span class="pre">ground_truth</span></code> is the original time series, and <code class="docutils literal notranslate"><span class="pre">forecast</span></code> is the forecast returned by the model. We show concrete examples with <code class="docutils literal notranslate"><span class="pre">ForecastMetric.sMAPE</span></code> below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">merlion.evaluate.forecast</span> <span class="kn">import</span> <span class="n">ForecastMetric</span>

<span class="c1"># We begin by computing the sMAPE of ARIMA's forecast (scale is 0 to 100)</span>
<span class="n">smape1</span> <span class="o">=</span> <span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                                    <span class="n">predict</span><span class="o">=</span><span class="n">forecast1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> sMAPE is </span><span class="si">{</span><span class="n">smape1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Next, we can visualize the actual forecast, and understand why it</span>
<span class="c1"># attains this particular sMAPE. Since ARIMA supports uncertainty</span>
<span class="c1"># estimation, we plot its error bars too.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                               <span class="n">plot_forecast_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Arima sMAPE is 3.795
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_11_1.png" src="../../_images/examples_forecast_1_ForecastFeatures_11_1.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We begin by computing the sMAPE of Prophet's forecast (scale is 0 to 100)</span>
<span class="n">smape2</span> <span class="o">=</span> <span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">sub_test_data</span><span class="p">,</span> <span class="n">forecast2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> sMAPE is </span><span class="si">{</span><span class="n">smape2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Next, we can visualize the actual forecast, and understand why it</span>
<span class="c1"># attains this particular sMAPE. Since Prophet supports uncertainty</span>
<span class="c1"># estimation, we plot its error bars too.</span>
<span class="c1"># Note that we can specify time_series_prev here as well, though it</span>
<span class="c1"># will not be visualized unless we also supply the keyword argument</span>
<span class="c1"># plot_time_series_prev=True.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                               <span class="n">time_series_prev</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span>
                               <span class="n">plot_forecast_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Prophet sMAPE is 2.913
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_12_1.png" src="../../_images/examples_forecast_1_ForecastFeatures_12_1.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We begin by computing the sMAPE of MSES's forecast (scale is 0 to 100)</span>
<span class="n">smape3</span> <span class="o">=</span> <span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">sub_test_data</span><span class="p">,</span> <span class="n">forecast3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> sMAPE is </span><span class="si">{</span><span class="n">smape3</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Next, we visualize the actual forecast, and understand why it</span>
<span class="c1"># attains this particular sMAPE.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                               <span class="n">plot_forecast_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MSES sMAPE is 4.377
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_13_1.png" src="../../_images/examples_forecast_1_ForecastFeatures_13_1.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute the sMAPE of the ensemble's forecast (scale is 0 to 100)</span>
<span class="n">smape_e</span> <span class="o">=</span> <span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">sub_test_data</span><span class="p">,</span> <span class="n">forecast_e</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ensemble sMAPE is </span><span class="si">{</span><span class="n">smape_e</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Visualize the forecast.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                                 <span class="n">plot_forecast_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ensemble sMAPE is 2.599
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_14_1.png" src="../../_images/examples_forecast_1_ForecastFeatures_14_1.png"/>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute the sMAPE of the selector's forecast (scale is 0 to 100)</span>
<span class="n">smape_s</span> <span class="o">=</span> <span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">sub_test_data</span><span class="p">,</span> <span class="n">forecast_s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Selector sMAPE is </span><span class="si">{</span><span class="n">smape_s</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Visualize the forecast.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">time_series</span><span class="o">=</span><span class="n">sub_test_data</span><span class="p">,</span>
                                 <span class="n">plot_forecast_uncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selector sMAPE is 3.795
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_forecast_1_ForecastFeatures_15_1.png" src="../../_images/examples_forecast_1_ForecastFeatures_15_1.png"/>
</div>
</div>
</section>
<section id="Saving-&amp;-Loading-Models">
<h2>Saving &amp; Loading Models<a class="headerlink" href="#Saving-&amp;-Loading-Models" title="Permalink to this heading"></a></h2>
<p>All models have a <code class="docutils literal notranslate"><span class="pre">save()</span></code> method and <code class="docutils literal notranslate"><span class="pre">load()</span></code> class method. Models may also be loaded with the assistance of the <code class="docutils literal notranslate"><span class="pre">ModelFactory</span></code>, which works for arbitrary models. The <code class="docutils literal notranslate"><span class="pre">save()</span></code> method creates a new directory at the specified path, where it saves a <code class="docutils literal notranslate"><span class="pre">json</span></code> file representing the model’s config, as well as a binary file for the model’s state.</p>
<p>We will demonstrate these behaviors using our <code class="docutils literal notranslate"><span class="pre">Prophet</span></code> model (<code class="docutils literal notranslate"><span class="pre">model2</span></code>) for concreteness.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">merlion.models.factory</span> <span class="kn">import</span> <span class="n">ModelFactory</span>

<span class="c1"># Save the model</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">"models"</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"models"</span><span class="p">,</span> <span class="s2">"prophet"</span><span class="p">)</span>
<span class="n">model2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Print the config saved</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"config.json"</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> Config"</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="c1"># Load the model using Prophet.load()</span>
<span class="n">model2_loaded</span> <span class="o">=</span> <span class="n">Prophet</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Load the model using the ModelFactory</span>
<span class="n">model2_factory_loaded</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Prophet"</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Prophet Config
{'daily_seasonality': 'auto',
 'dim': 1,
 'holidays': None,
 'max_forecast_steps': None,
 'seasonality_mode': 'additive',
 'target_seq_index': 0,
 'transform': {'name': 'Identity'},
 'uncertainty_samples': 100,
 'weekly_seasonality': 'auto',
 'yearly_seasonality': 'auto'}
</pre></div></div>
</div>
<p>We can do the same exact thing with ensembles! Note that the ensemble stores its underlying models in a nested structure. Additionally, the combiner (which is saved in the <code class="docutils literal notranslate"><span class="pre">ForecasterEnsembleConfig</span></code>), keeps track of the sMAPE achieved by each model (the <code class="docutils literal notranslate"><span class="pre">metric_values</span></code> key). This is all reflected in the config.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Save the selector</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"models"</span><span class="p">,</span> <span class="s2">"selector"</span><span class="p">)</span>
<span class="n">selector</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Print the config saved. Note that we've saved all individual models,</span>
<span class="c1"># and their paths are specified under the model_paths key.</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"config.json"</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Selector Config"</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="c1"># Load the selector</span>
<span class="n">selector_loaded</span> <span class="o">=</span> <span class="n">ForecasterEnsemble</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Load the selector using the ModelFactory</span>
<span class="n">selector_factory_loaded</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"ForecasterEnsemble"</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Selector Config
{'combiner': {'abs_score': False,
              'metric': 'ForecastMetric.sMAPE',
              'metric_values': [5.537074367680436,
                                8.691874724892063,
                                17.72980301555831],
              'n_models': 3,
              'name': 'ModelSelector'},
 'dim': 1,
 'max_forecast_steps': None,
 'models': [{'dim': 1,
             'max_forecast_steps': 100,
             'name': 'Arima',
             'order': [20, 1, 5],
             'target_seq_index': 0,
             'transform': {'aggregation_policy': 'Mean',
                           'granularity': 3600.0,
                           'missing_value_policy': 'Interpolate',
                           'name': 'TemporalResample',
                           'origin': 0.0,
                           'remove_non_overlapping': True,
                           'trainable_granularity': False}},
            {'daily_seasonality': 'auto',
             'dim': 1,
             'holidays': None,
             'max_forecast_steps': None,
             'name': 'Prophet',
             'seasonality_mode': 'additive',
             'target_seq_index': 0,
             'transform': {'name': 'Identity'},
             'uncertainty_samples': 100,
             'weekly_seasonality': 'auto',
             'yearly_seasonality': 'auto'},
            {'accel_weight': 1.0,
             'dim': 1,
             'eta': 0.0,
             'inflation': 1.0,
             'max_backstep': 60,
             'max_forecast_steps': 100,
             'name': 'MSES',
             'optimize_acc': True,
             'phi': 2.0,
             'recency_weight': 0.5,
             'rho': 0.0,
             'target_seq_index': 0,
             'transform': {'aggregation_policy': 'Mean',
                           'granularity': 3600.0,
                           'missing_value_policy': 'Interpolate',
                           'name': 'TemporalResample',
                           'origin': 0.0,
                           'remove_non_overlapping': True,
                           'trainable_granularity': False}}],
 'target_seq_index': 0,
 'transform': {'name': 'Identity'},
 'verbose': False}
</pre></div></div>
</div>
</section>
<section id="Simulating-Live-Model-Deployment">
<h2>Simulating Live Model Deployment<a class="headerlink" href="#Simulating-Live-Model-Deployment" title="Permalink to this heading"></a></h2>
<p>A typical model deployment scenario is as follows: 1. Train an initial model on some recent historical data 1. At a regular interval <code class="docutils literal notranslate"><span class="pre">cadence</span></code>, obtain the model’s forecast for a certain <code class="docutils literal notranslate"><span class="pre">horizon</span></code> 1. At a regular interval <code class="docutils literal notranslate"><span class="pre">retrain_freq</span></code>, retrain the entire model on the most recent data 1. Optionally, specify a maximum amount of data (<code class="docutils literal notranslate"><span class="pre">train_window</span></code>) that the model should use for training</p>
<p>We provide a <code class="docutils literal notranslate"><span class="pre">ForecastEvaluator</span></code> object which simulates the above deployment scenario, and also allows a user to evaluate the quality of the forecaster according to an evaluation metric of their choice. We illustrate two examples below, using ARIMA for the first example, and the model selector for the second.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">merlion.evaluate.forecast</span> <span class="kn">import</span> <span class="n">ForecastEvaluator</span><span class="p">,</span> <span class="n">ForecastEvaluatorConfig</span><span class="p">,</span> <span class="n">ForecastMetric</span>

<span class="k">def</span> <span class="nf">create_evaluator</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="c1"># Re-initialize the model, so we can re-train it from scratch</span>
    <span class="n">model</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="c1"># Create an evaluation pipeline for the model, where we</span>
    <span class="c1"># -- get the model's forecast every hour</span>
    <span class="c1"># -- have the model forecast for a horizon of 6 hours</span>
    <span class="c1"># -- re-train the model every 12 hours</span>
    <span class="c1"># -- when we re-train the model, retrain it on only the past 2 weeks of data</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">ForecastEvaluator</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ForecastEvaluatorConfig</span><span class="p">(</span>
            <span class="n">cadence</span><span class="o">=</span><span class="s2">"1h"</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="s2">"6h"</span><span class="p">,</span> <span class="n">retrain_freq</span><span class="o">=</span><span class="s2">"12h"</span><span class="p">,</span> <span class="n">train_window</span><span class="o">=</span><span class="s2">"14d"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">evaluator</span>
</pre></div>
</div>
</div>
<p>First, let’s evaluate ARIMA.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Obtain the results of running the evaluation pipeline for ARIMA.</span>
<span class="c1"># These result objects are to be treated as a black box, and should be</span>
<span class="c1"># passed directly to the evaluator's evaluate() method.</span>
<span class="n">model1_evaluator</span> <span class="o">=</span> <span class="n">create_evaluator</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
<span class="n">model1_train_result</span><span class="p">,</span> <span class="n">model1_test_result</span> <span class="o">=</span> <span class="n">model1_evaluator</span><span class="o">.</span><span class="n">get_predict</span><span class="p">(</span>
    <span class="n">train_vals</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_vals</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ForecastEvaluator: 100%|██████████| 169200/169200 [00:07&lt;00:00, 22208.87it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Evaluate ARIMA's sMAPE and RMSE</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">model1_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">predict</span><span class="o">=</span><span class="n">model1_test_result</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="p">)</span>
<span class="n">rmse</span>  <span class="o">=</span> <span class="n">model1_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">predict</span><span class="o">=</span><span class="n">model1_test_result</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">ForecastMetric</span><span class="o">.</span><span class="n">RMSE</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> sMAPE: </span><span class="si">{</span><span class="n">smape</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> RMSE:  </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Arima sMAPE: 2.013
Arima RMSE:  143.281
</pre></div></div>
</div>
<p>Next, we will evaluate the ensemble (taking the mean prediction of ARIMA, Prophet, and MSES every time the models are called).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Obtain the results of running the evaluation pipeline for the ensemble.</span>
<span class="c1"># These result objects are to be treated as a black box, and should be</span>
<span class="c1"># passed directly to the evaluator's evaluate() method.</span>
<span class="n">ensemble_evaluator</span> <span class="o">=</span> <span class="n">create_evaluator</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span>
<span class="n">ensemble_train_result</span><span class="p">,</span> <span class="n">ensemble_test_result</span> <span class="o">=</span> <span class="n">ensemble_evaluator</span><span class="o">.</span><span class="n">get_predict</span><span class="p">(</span>
    <span class="n">train_vals</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_vals</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
ForecastEvaluator:  26%|██▌       | 43200/169200 [00:03&lt;00:09, 12999.69it/s]INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:prophet:Disabling weekly seasonality. Run prophet with weekly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
ForecastEvaluator:  51%|█████     | 86400/169200 [00:09&lt;00:06, 12030.39it/s]INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:prophet:Disabling weekly seasonality. Run prophet with weekly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
ForecastEvaluator:  77%|███████▋  | 129600/169200 [00:16&lt;00:03, 11949.85it/s]INFO:merlion.models.ensemble.forecast:Training model 1/3 (Arima)...
INFO:merlion.models.ensemble.forecast:Training model 2/3 (Prophet)...
INFO:prophet:Disabling yearly seasonality. Run prophet with yearly_seasonality=True to override this.
INFO:prophet:Disabling weekly seasonality. Run prophet with weekly_seasonality=True to override this.
INFO:merlion.models.ensemble.forecast:Training model 3/3 (MSES)...
ForecastEvaluator: 100%|██████████| 169200/169200 [00:22&lt;00:00, 7586.00it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Evaluate the selector's sMAPE and RMSE</span>
<span class="n">smape</span> <span class="o">=</span> <span class="n">ensemble_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">predict</span><span class="o">=</span><span class="n">ensemble_test_result</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">ForecastMetric</span><span class="o">.</span><span class="n">sMAPE</span><span class="p">)</span>
<span class="n">rmse</span>  <span class="o">=</span> <span class="n">ensemble_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span>
    <span class="n">predict</span><span class="o">=</span><span class="n">ensemble_test_result</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">ForecastMetric</span><span class="o">.</span><span class="n">RMSE</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ensemble sMAPE: </span><span class="si">{</span><span class="n">smape</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ensemble RMSE:  </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Ensemble sMAPE: 2.896
Ensemble RMSE:  210.626
</pre></div></div>
</div>
</section>
</section>
</div>
</div>
<footer><div aria-label="Footer" class="rst-footer-buttons" role="navigation">
<a accesskey="p" class="btn btn-neutral float-left" href="0_ForecastIntro.html" rel="prev" title="A Gentle Introduction to Forecasting in Merlion"><span aria-hidden="true" class="fa fa-arrow-circle-left"></span> Previous</a>
<a accesskey="n" class="btn btn-neutral float-right" href="2_ForecastMultivariate.html" rel="next" title="Multivariate Time Series Forecasting">Next <span aria-hidden="true" class="fa fa-arrow-circle-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<p>© Copyright 2021, salesforce.com, inc..</p>
</div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" data-toggle="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span class="fa fa-book"> Versions</span>
      v1.1.3
      <span class="fa fa-caret-down"></span>
</span>
<div class="rst-other-versions">
<dl><dt>Versions</dt><dd><a href="../../../latest/index.html">latest</a></dd><dd><a href="../../../v2.0.0/index.html">v2.0.0</a></dd><dd><a href="../../../v1.3.1/index.html">v1.3.1</a></dd><dd><a href="../../../v1.3.0/index.html">v1.3.0</a></dd><dd><a href="../../../v1.2.5/index.html">v1.2.5</a></dd><dd><a href="../../../v1.2.4/index.html">v1.2.4</a></dd><dd><a href="../../../v1.2.3/index.html">v1.2.3</a></dd><dd><a href="../../../v1.2.2/index.html">v1.2.2</a></dd><dd><a href="../../../v1.2.1/index.html">v1.2.1</a></dd><dd><a href="../../../v1.2.0/index.html">v1.2.0</a></dd><dd><strong><a href="../../../v1.1.3/index.html">v1.1.3</a></strong></dd><dd><a href="../../../v1.1.2/index.html">v1.1.2</a></dd><dd><a href="../../../v1.1.1/index.html">v1.1.1</a></dd><dd><a href="../../../v1.1.0/index.html">v1.1.0</a></dd><dd><a href="../../../v1.0.2/index.html">v1.0.2</a></dd><dd><a href="../../../v1.0.1/index.html">v1.0.1</a></dd><dd><a href="../../../v1.0.0/index.html">v1.0.0</a></dd></dl>
</div>
</div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>